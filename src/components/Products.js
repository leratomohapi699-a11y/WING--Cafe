import React, {useEffect, useState} from 'react';import Swal from 'sweetalert2';
export default function Products(){ const [products,setProducts]=useState([]); const [form,setForm]=useState({}); const [editing,setEditing]=useState(null);
  useEffect(()=>fetchProducts(),[]);
  function fetchProducts(){ fetch('/api/products').then(r=>r.json()).then(setProducts); }
  async function save(e){ e.preventDefault(); if(editing){ await fetch('/api/products/'+editing.id,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(form)}); Swal.fire('Saved','Product updated','success'); } else { await fetch('/api/products',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(form)}); Swal.fire('Saved','Product added','success'); } setForm({}); setEditing(null); fetchProducts(); }
  function edit(p){ setEditing(p); setForm(p); window.scrollTo(0,0); }
  async function remove(id){ const r = await Swal.fire({title:'Delete?',text:'This will remove the product', showCancelButton:true}); if(r.isConfirmed){ await fetch('/api/products/'+id,{method:'DELETE'}); Swal.fire('Deleted','Product removed','success'); fetchProducts(); } }
  return (<div><div className='card'><h3>{editing?'Edit product':'Add product'}</h3><form onSubmit={save}><div className='form-row'><input className='input' placeholder='Name' value={form.name||''} onChange={e=>setForm({...form,name:e.target.value})} required/><input className='input' placeholder='Category' value={form.category||''} onChange={e=>setForm({...form,category:e.target.value})}/><input type='number' className='input' placeholder='Price' value={form.price||0} onChange={e=>setForm({...form,price:Number(e.target.value)})}/><input type='number' className='input' placeholder='Quantity' value={form.quantity||0} onChange={e=>setForm({...form,quantity:Number(e.target.value)})}/></div><div style={{marginTop:8}}><textarea className='input' placeholder='Description' value={form.description||''} onChange={e=>setForm({...form,description:e.target.value})}></textarea></div><div style={{marginTop:8}}><button className='button' type='submit'>Save</button>{editing&&<button type='button' className='button alt' style={{marginLeft:8}} onClick={()=>{setEditing(null);setForm({});}}>Cancel</button>}</div></form></div><div style={{marginTop:12}} className='card table'><h3>Products</h3><table><thead><tr><th>Name</th><th>Category</th><th>Qty</th><th>Price</th><th>Actions</th></tr></thead><tbody>{products.map(p=>(<tr key={p.id}><td>{p.name}<div className='small'>{p.description}</div></td><td>{p.category}</td><td>{p.quantity}</td><td>{'M'+Number(p.price).toFixed(2)}</td><td><button className='button' onClick={()=>edit(p)}>Edit</button><button className='button alt' style={{marginLeft:8}} onClick={()=>remove(p.id)}>Delete</button></td></tr>))}</tbody></table></div></div>); }